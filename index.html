<head>
  <title>Abby's Garden</title>
  <link rel="icon" type="image/gif" href="https://pixelsafari.neocities.org/favicon/nature/plant/plant2.gif">
  <style>
    body {
      width: 100vw;
      height: 100vh;
      position: relative;
      overflow: visible;
      background: url("garden-background.png") no-repeat center center;
      background-size: cover;
    }

    img {
      position: absolute;
      z-index: 9999;
    }

    @keyframes reveal {
      0% {
        clip-path: inset(95% 0% 0% 0%);
        opacity: 0;
      }

      20% {
        opacity: 1;
      }

      100% {
        clip-path: inset(0% 0% 0% 0%);
      }
    }


    .growing-flower {
      animation: reveal 4s ease-in-out forwards;
    }
  </style>

</head>

<body>
  <script>
    const flowerImages = ["https://colieskitchen.com/wp-content/uploads/2020/02/cartoon-flowers-png-8.png",
      "https://icons.iconarchive.com/icons/mag1cwind0w/o-sunny-day/128/osd-flower-icon.png",
      "https://icons.iconarchive.com/icons/iconarchive/wild-camping/128/Flower-Yellow-icon.png",
      "https://icons.iconarchive.com/icons/iconarchive/childrens-book-animals/128/Garden-Flower-icon.png",
      "https://icons.iconarchive.com/icons/fasticon/nature/128/Pink-Flower-icon.png",
      "https://icons.iconarchive.com/icons/fasticon/nature/128/White-Flower-icon.png",
      "https://cdn.creazilla.com/cliparts/12973/yellow-tulip-clipart-xl.png",
      "https://gallery.yopriceville.com/var/albums/Free-Clipart-Pictures/Flowers-PNG/Peony_with_Stem_PNG_Clipart.png?m=1629800297",
      "https://gallery.yopriceville.com/var/albums/Free-Clipart-Pictures/Flowers-PNG/Red_Gerber_with_Stem_PNG_Clipart_Image.png?m=1629799612",

      "https://cdn.creazilla.com/cliparts/3158730/flower-clipart-md.png",

      "https://www.pngfind.com/pngs/m/70-703042_stem-pink-orchids-png-clipart-orchid-flower-clipart.png",

      "https://clipart-library.com/images/yikr446iE.png",

      "https://clipart-library.com/img/1721927.png"


    ];

    const links = [
      "https://abigailstarr.github.io/final-project/",
      "https://abigailstarr.github.io/redesign-IG/",
      "https://abigailstarr.github.io/internet-letter/"
    ];

    function RandomInteger(min, max) {
      min = Math.ceil(min);
      max = Math.floor(max);
      return Math.floor(Math.random() * (max - min + 1) + min);
    }

    function saveFlower(x, y, img, link) {
      const savedFlowers = JSON.parse(localStorage.getItem("flowers")) || [];
      savedFlowers.push({
        x,
        y,
        img,
        link
      });
      localStorage.setItem("flowers", JSON.stringify(savedFlowers));
    }

    function recreateFlower(x, y, img, link) {
      const flowerFinal = document.createElement("img");
      flowerFinal.style.position = "absolute";
      flowerFinal.style.width = "64px";
      flowerFinal.style.height = "64px";
      flowerFinal.style.objectFit = "cover";
      flowerFinal.style.cursor = "pointer";

      const flowerLink = document.createElement("a");
      flowerLink.href = link;
      flowerLink.target = "_blank";
      flowerLink.style.position = "absolute";
      flowerLink.style.left = x + "px";
      flowerLink.style.top = y + "px";
      flowerLink.style.display = "block";

      flowerLink.appendChild(flowerFinal);
      document.body.appendChild(flowerLink);
    }


    function addflower(event) {
      //make sure user can click on flower without planting another
      if (event.target.tagName === "IMG" && event.target.classList.contains("bloomed-flower")) {
        return;
      }

      //grab mouse location
      const clickX = event.clientX - 32;
      const clickY = event.clientY - 64;
      console.log("‚úÖ Corrected Click Position:", {
        clickX,
        clickY
      });

      //pick a random flower
      let randomIndex = Math.floor(Math.random() * flowerImages.length);
      const randomFlower = flowerImages[randomIndex];

      //pick a random link
      randomIndex = Math.floor(Math.random() * links.length)
      const randomLink = links[randomIndex];

      //determine a random growing time
      const growTime = RandomInteger(1, 1) * 60 * 1000; // miliseconds to minutes conversion, flower grows for 1-3 minutes
      let remainingTime = growTime / 1000;

      //create a banner div
      const banner = document.createElement("div")
      banner.innerText = `You planted a flower! It will bloom in ${Math.floor(remainingTime / 60)} minutes!`;
      banner.style.position = "fixed";
      banner.style.top = "2em";
      banner.style.left = "50%";
      banner.style.transform = "translateX(-50%)";
      banner.style.background = "rgba(255, 255, 255, 0.9)";
      banner.style.color = "green";
      banner.style.padding = "10px 20px";
      banner.style.fontSize = "20px";

      // add banner to body
      document.body.appendChild(banner);

      //add loading image on the page where the user clicked
      const flower = document.createElement("img");
      flower.src = "https://media4.giphy.com/media/m9jBQWzSGGV4g4ybou/giphy.gif?cid=6c09b952kr57ud2hlj1m8jxlkb8odndtm5c3z9wlalsjucgw&ep=v1_internal_gif_by_id&rid=giphy.gif&ct=s";
      flower.style.position = "absolute";
      flower.style.width = "64px";
      flower.style.height = "64px";
      flower.style.objectFit = "cover";
      flower.style.left = clickX + "px";
      //assuming flower is 128x128px
      flower.style.top = clickY + "px";
      flower.style.cursor = "pointer"; //indicates interactivity
      document.body.appendChild(flower);

      //remove after 5 seconds
      setTimeout(() => {
        banner.remove();

        //create a countdown div
        const countdown = document.createElement("div");
        countdown.style.position = "fixed";
        countdown.style.top = "3em";
        countdown.style.left = "50%";
        countdown.style.transform = "translateX(-50%)";
        countdown.style.background = "rgba(255, 255, 255, 0.9)";
        countdown.style.color = "green";
        countdown.style.padding = "10px 20px";
        countdown.style.fontSize = "20px";
        document.body.appendChild(countdown);

        //create countdown logic
        function updateCountdown() {
          let minutes = Math.floor(remainingTime / 60);
          let seconds = remainingTime % 60;
          countdown.innerText = `‚è≥ Flower blooming in ${minutes}:${seconds < 10 ? "0" : ""}${seconds} minutes...`;

          if (remainingTime > 0) {
            remainingTime--;
            setTimeout(updateCountdown, 1000);
          } else { //i.e. when timer finishes
            countdown.remove();

            //remove can & replace
            document.body.removeChild(flower);

            saveFlower(clickX, clickY, randomFlower, randomLink);
            const flowerFinal = recreateFlower(clickX, clickY, randomFlower, randomLink);
            flowerFinal.classList.add("growing-flower", "bloomed-flower");
            flowerFinal.addEventListener("click", function(event) {
              event.stopPropagation();
            });

            //define & display congrats banner
            const congrt = document.createElement("div");
            congrt.innerText = "üéâ Your flower is blooming! üå∏";
            congrt.style.position = "fixed";
            congrt.style.top = "2em";
            congrt.style.left = "50%";
            congrt.style.transform = "translateX(-50%)";
            congrt.style.background = "rgba(255, 255, 255, 0.9)";
            congrt.style.color = "green";
            congrt.style.padding = "10px 20px";
            congrt.style.fontSize = "20px";
            document.body.appendChild(congrt);

            //remove congrats banner after 5 seconds
            setTimeout(() => congrt.remove(), 5000);
          }
        }
        updateCountdown();

      }, 5000); // wait 5 seconds before initializing countdown
    }

    function clearGarden() {
      localStorage.removeItem("flowers");
      document.querySelectorAll("a").forEach(flower => flower.remove());
    }

    const resetButton = document.createElement("button");
    resetButton.innerText = "üóëÔ∏è Reset Garden";
    resetButton.style.position = "fixed";
    resetButton.style.bottom = "10px";
    resetButton.style.right = "10px";
    resetButton.style.padding = "10px";
    resetButton.style.fontSize = "16px";
    resetButton.style.cursor = "pointer";
    resetButton.style.background = "red";
    resetButton.style.color = "white";
    resetButton.style.border = "none";
    resetButton.style.borderRadius = "5px";
    resetButton.style.boxShadow = "2px 2px 5px rgba(0,0,0,0.2)";
    //make sure that clicking reset doesn't trigger another flower planting
    resetButton.addEventListener("click", (event) => {
      event.stopPropagation();
      clearGarden();
    });

    window.onload = function() {

      //load in lofi background music
      const lofiMusic = new Audio("https://www.bensound.com/bensound-music/bensound-lofi.mp3");
      lofiMusic.loop = true;
      lofiMusic.volume = 0.4;

      // load in garden sounds (birds & wind)
      const gardenSounds = new Audio("https://www.soundjay.com/nature/sounds/birds-forest-1.mp3");
      gardenSounds.loop = true;
      gardenSounds.volume = 0.2;

      //create function that still plays audio even if the browser has autoplay blocked
      function playAudio() {
        lofiMusic.play().catch(() => {
          document.addEventListener("mousemove", () => lofiMusic.play(), {
            one: true
          });
        });

        gardenSounds.play().catch(() => {
          document.addEventListener("mousemove", () => gardenSounds.play(), {
            once: true
          });
        });
      }
      playAudio();

      const savedFlowers = JSON.parse(localStorage.getItem("flowers")) || [];

      savedFlowers.forEach(flower => {
        recreateFlower(flower.x, flower.x, flower.img, flower.link)
      });

      document.body.appendChild(resetButton);
    };

    document.addEventListener("click", addflower);
  </script>

</body>